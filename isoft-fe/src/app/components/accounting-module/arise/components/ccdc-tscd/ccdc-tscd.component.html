<!--account debit credit code-->
<div class="field flex align-items-center font-bold mb-2">
    <div class="col-12 grid formgroup mt-3">
        <div class="field col-1">
            <label for="debit" class="mb-1 font-bold">{{
                "label.debit_code_name" | translate
            }}</label>
            <p-autoComplete
                #debitCodeTmp
                [ngModel]="fc['debitCode'].value"
                [suggestions]="debitCodeFilter"
                [ngClass]="{
                    'autocomplete-panel-hidden': isHiddenAutoCompleteDebitCode
                }"
                [emptyMessage]="emptyMessageAutoComplete"
                [showEmptyMessage]="true"
                [autoHighlight]="true"
                [lazy]="true"
                [virtualScroll]="true"
                [virtualScrollItemSize]="20"
                [completeOnFocus]="true"
                [showClear]="false"
                [autoWidth]="false"
                (completeMethod)="filterDebitCode($event)"
                (onFocus)="debitCodeTmp.handleDropdownClick()"
                (input)="fc['debitCode'].setValue($event?.target?.value)"
                (onClear)="onClearDebitCode()"
                (onSelect)="onSelectDebitCode($event)"
                field="code"
                class="p-inputtext-sm capitalize"
            >
                <ng-template let-debit pTemplate="item">
                    <div class="w-auto flex flex-nowrap align-content-center">
                        <div class="w-5rem border-right-1">
                            <p>{{ debit.code }}</p>
                        </div>
                        <div
                            class="w-26rem overflow-hidden border-right-1 px-1"
                        >
                            <marquee *ngIf="debit.name?.length > 54">{{
                                debit.name
                            }}</marquee>
                            <p class="mb-0" *ngIf="debit.name?.length <= 54">
                                {{ debit.name }}
                            </p>
                        </div>
                        <div class="w-6rem border-right-1 px-1">
                            <p>Tính chất {{ debit.accGroup }}</p>
                        </div>
                        <div class="w-6rem px-1">
                            <p>{{ debit.closingDebit | number: "1.0-0" }}</p>
                        </div>
                    </div>
                </ng-template>
            </p-autoComplete>
        </div>
        <div class="field col-1">
            <label for="debitDetail1" class="mb-1 font-bold">C.Tiết 1</label>
            <p-autoComplete
                #debitDetailCodeFirstTmp
                [ngModel]="fc['debitDetailCodeFirst'].value"
                [ngClass]="{
                    'autocomplete-panel-hidden':
                        isHiddenAutoCompleteDebitDetailCodeFirst
                }"
                [emptyMessage]="emptyMessageAutoComplete"
                [suggestions]="debitDetailCodeFirstFilter"
                [showEmptyMessage]="true"
                [autoHighlight]="true"
                [delay]="500"
                [disabled]="!isDebitCodeHas || !isDebitCodeHasDetails"
                [completeOnFocus]="true"
                [showClear]="false"
                [autoWidth]="false"
                (completeMethod)="filterDebitDetailCodeFirst($event)"
                (onFocus)="debitDetailCodeFirstTmp.handleDropdownClick()"
                (input)="
                    fc['debitDetailCodeFirst'].setValue($event?.target?.value)
                "
                (onKeyUp)="
                    onKeyUpAutoCompleteLazyLoadding({
                        event: $event,
                        key: configAriseEnum.debitDetailCodeFirst
                    })
                "
                (onClear)="onClearDebitDetailCodeFirst()"
                (onSelect)="onSelectDebitDetailCodeFirst($event)"
                field="code"
                class="p-inputtext-sm capitalize"
            >
                <ng-template let-debit pTemplate="item">
                    <div
                        *ngIf="debit"
                        class="w-auto flex flex-nowrap align-content-center"
                    >
                        <div class="w-5rem border-right-1">
                            <p>{{ debit.code }}</p>
                        </div>
                        <div class="w-3rem border-right-1 px-1">
                            <p>{{ debit.warehouseCode }}</p>
                        </div>
                        <div
                            class="w-26rem overflow-hidden border-right-1 px-1"
                        >
                            <marquee *ngIf="debit.name?.length > 54">{{
                                debit.name
                            }}</marquee>
                            <p class="mb-0" *ngIf="debit.name?.length <= 54">
                                {{ debit.name }}
                            </p>
                        </div>
                        <div class="w-6rem border-right-1 px-1">
                            <p>{{ debit.closingStockQuantity || 0 }}</p>
                        </div>
                        <div class="w-6rem px-1">
                            <p>
                                {{ debit.closingDebit || 0 | number: "1.0-0" }}
                            </p>
                        </div>
                    </div>
                </ng-template>
            </p-autoComplete>
        </div>
        <div class="field col-1">
            <label for="debitDetail2" class="mb-1 font-bold">C.Tiết 2</label>
            <p-autoComplete
                #debitDetailCodeSecondTmp
                [ngModel]="fc['debitDetailCodeSecond'].value"
                [ngClass]="{
                    'autocomplete-panel-hidden':
                        isHiddenAutoCompleteDebitDetailCodeSecond
                }"
                [emptyMessage]="emptyMessageAutoComplete"
                [suggestions]="debitDetailCodeSecondFilter"
                [showEmptyMessage]="true"
                [autoHighlight]="true"
                [delay]="500"
                [disabled]="
                    !isDebitDetailCodeFirstHasDetails ||
                    !isDebitDetailCodeFirstHas
                "
                [completeOnFocus]="true"
                [showClear]="false"
                [autoWidth]="false"
                (completeMethod)="filterDebitDetailCodeSecond($event)"
                (onKeyUp)="
                    onKeyUpAutoCompleteLazyLoadding({
                        event: $event,
                        key: configAriseEnum.debitDetailCodeSecond
                    })
                "
                (onFocus)="debitDetailCodeSecondTmp.handleDropdownClick()"
                (input)="
                    fc['debitDetailCodeSecond'].setValue($event?.target?.value)
                "
                (onClear)="onClearDebitDetailCodeSecond()"
                (onSelect)="onSelectDebitDetailCodeSecond($event)"
                field="code"
                class="p-inputtext-sm capitalize"
            >
                <ng-template let-debit pTemplate="item">
                    <div
                        *ngIf="debit"
                        class="w-auto flex flex-nowrap align-content-center"
                    >
                        <div class="w-5rem border-right-1">
                            <p>{{ debit.code }}</p>
                        </div>
                        <div class="w-3rem border-right-1 px-1">
                            <p>{{ debit.warehouseCode }}</p>
                        </div>
                        <div
                            class="w-26rem overflow-hidden border-right-1 px-1"
                        >
                            <marquee *ngIf="debit.name?.length > 54">{{
                                debit.name
                            }}</marquee>
                            <p class="mb-0" *ngIf="debit.name?.length <= 54">
                                {{ debit.name }}
                            </p>
                        </div>
                        <div class="w-6rem border-right-1 px-1">
                            <p>{{ debit.closingStockQuantity || 0 }}</p>
                        </div>
                        <div class="w-6rem px-1">
                            <p>
                                {{ debit.closingDebit || 0 | number: "1.0-0" }}
                            </p>
                        </div>
                    </div>
                </ng-template>
            </p-autoComplete>
        </div>
        <!--Tài khoản có-->
        <div class="field col-1">
            <label for="credit" class="mb-1 font-bold">TK Có</label>
            <p-autoComplete
                #creditCodeTmp
                [ngModel]="fc['creditCode'].value"
                [ngClass]="{
                    'autocomplete-panel-hidden': isHiddenAutoCompleteCreditCode
                }"
                [emptyMessage]="emptyMessageAutoComplete"
                [suggestions]="creditCodeFilter"
                [showEmptyMessage]="true"
                [autoHighlight]="true"
                [lazy]="true"
                [virtualScroll]="true"
                [virtualScrollItemSize]="20"
                [completeOnFocus]="true"
                [showClear]="false"
                [autoWidth]="false"
                (completeMethod)="filterCreditCode($event)"
                (onFocus)="creditCodeTmp.handleDropdownClick()"
                (input)="fc['creditCode'].setValue($event?.target?.value)"
                (onClear)="onClearCreditCode()"
                (onSelect)="onSelectCreditCode($event)"
                field="code"
                class="p-inputtext-sm capitalize"
            >
                <ng-template let-credit pTemplate="item">
                    <div class="w-auto flex flex-nowrap align-content-center">
                        <div class="w-5rem border-right-1">
                            <p>{{ credit.code }}</p>
                        </div>
                        <div
                            class="w-26rem overflow-hidden border-right-1 px-1"
                        >
                            <marquee *ngIf="credit.name?.length > 54">{{
                                credit.name
                            }}</marquee>
                            <p class="mb-0" *ngIf="credit.name?.length <= 54">
                                {{ credit.name }}
                            </p>
                        </div>
                        <div class="w-6rem border-right-1 px-1">
                            <p>{{ credit.accGroup }}</p>
                        </div>
                        <div class="w-6rem px-1">
                            <p>{{ credit.closingDebit | number: "1.0-0" }}</p>
                        </div>
                    </div>
                </ng-template>
            </p-autoComplete>
        </div>
        <div class="field col-1">
            <label for="creditDetail1" class="mb-1 font-bold">C.Tiết 1</label>
            <p-autoComplete
                #creditDetailCodeFirstTmp
                [ngModel]="fc['creditDetailCodeFirst'].value"
                [ngClass]="{
                    'autocomplete-panel-hidden':
                        isHiddenAutoCompleteCreditDetailCodeFirst
                }"
                [emptyMessage]="emptyMessageAutoComplete"
                [suggestions]="creditDetailCodeFirstFilter"
                [showEmptyMessage]="true"
                [autoHighlight]="true"
                [delay]="500"
                [disabled]="!isCreditCodeHas || !isCreditCodeHasDetails"
                [completeOnFocus]="true"
                [showClear]="false"
                [autoWidth]="false"
                (completeMethod)="filterCreditDetailCodeFirst($event)"
                (onFocus)="creditDetailCodeFirstTmp.handleDropdownClick()"
                (onKeyUp)="
                    onKeyUpAutoCompleteLazyLoadding({
                        event: $event,
                        key: configAriseEnum.creditDetailCodeFirst
                    })
                "
                (input)="
                    fc['creditDetailCodeFirst'].setValue($event?.target?.value)
                "
                (onClear)="onClearCreditDetailCodeFirst()"
                (onSelect)="onSelectCreditDetailCodeFirst($event)"
                field="code"
                class="p-inputtext-sm capitalize"
            >
                <ng-template let-credit pTemplate="item">
                    <div
                        *ngIf="credit"
                        class="w-auto flex flex-nowrap align-content-center"
                    >
                        <div class="w-5rem border-right-1">
                            <p>{{ credit.code }}</p>
                        </div>
                        <div class="w-3rem border-right-1 px-1">
                            <p>{{ credit.warehouseCode }}</p>
                        </div>
                        <div
                            class="w-26rem overflow-hidden border-right-1 px-1"
                        >
                            <marquee *ngIf="credit.name?.length > 54">{{
                                credit.name
                            }}</marquee>
                            <p class="mb-0" *ngIf="credit.name?.length <= 54">
                                {{ credit.name }}
                            </p>
                        </div>
                        <div class="w-6rem border-right-1 px-1">
                            <p>{{ credit.closingStockQuantity || 0 }}</p>
                        </div>
                        <div class="w-6rem px-1">
                            <p>
                                {{ credit.closingDebit || 0 | number: "1.0-0" }}
                            </p>
                        </div>
                    </div>
                </ng-template>
            </p-autoComplete>
        </div>
        <div class="field col-1">
            <label for="creditDetail2" class="mb-1 font-bold">C.Tiết 2</label>
            <p-autoComplete
                #creditDetailCodeSecondTmp
                [ngModel]="fc['creditDetailCodeSecond'].value"
                [ngClass]="{
                    'autocomplete-panel-hidden':
                        isHiddenAutoCompleteCreditDetailCodeSecond
                }"
                [emptyMessage]="emptyMessageAutoComplete"
                [suggestions]="creditDetailCodeSecondFilter"
                [showEmptyMessage]="true"
                [autoHighlight]="true"
                [delay]="500"
                [disabled]="
                    !isCreditDetailCodeFirstHasDetails ||
                    !isCreditDetailCodeFirstHas
                "
                [completeOnFocus]="true"
                [showClear]="false"
                [autoWidth]="false"
                (completeMethod)="filterCreditDetailCodeSecond($event)"
                (onFocus)="creditDetailCodeSecondTmp.handleDropdownClick()"
                (onKeyUp)="
                    onKeyUpAutoCompleteLazyLoadding({
                        event: $event,
                        key: configAriseEnum.creditDetailCodeSecond
                    })
                "
                (input)="
                    fc['creditDetailCodeSecond'].setValue($event?.target?.value)
                "
                (onClear)="onClearCreditDetailCodeSecond()"
                (onSelect)="onSelectCreditDetailCodeSecond($event)"
                field="code"
                class="p-inputtext-sm capitalize"
            >
                <ng-template let-credit pTemplate="item">
                    <div
                        *ngIf="credit"
                        class="w-auto flex flex-nowrap align-content-center"
                    >
                        <div class="w-5rem border-right-1">
                            <p>{{ credit.code }}</p>
                        </div>
                        <div class="w-3rem border-right-1 px-1">
                            <p>{{ credit.warehouseCode }}</p>
                        </div>
                        <div
                            class="w-26rem overflow-hidden border-right-1 px-1"
                        >
                            <marquee *ngIf="credit.name.length > 54">{{
                                credit.name
                            }}</marquee>
                            <p class="mb-0" *ngIf="credit.name.length <= 54">
                                {{ credit.name }}
                            </p>
                        </div>
                        <div class="w-6rem border-right-1 px-1">
                            <p>{{ credit.closingStockQuantity || 0 }}</p>
                        </div>
                        <div class="w-6rem px-1">
                            <p>
                                {{ credit.closingDebit || 0 | number: "1.0-0" }}
                            </p>
                        </div>
                    </div>
                </ng-template>
            </p-autoComplete>
        </div>
        <div class="filed col-1" style="line-height: 45px">
            <button
                pButton
                class="bg-primary w-fit btn-update-ccdc"
                [ngClass]="{ disabled: !checkButtonSave() }"
                (click)="onUpdateAccount()"
            >
                Lưu
            </button>
        </div>
        <small *ngIf="isErrorText" class="p-error w--100 mt-3"
            >Bạn cần chọn thêm TSCĐ</small
        >
    </div>

    <!--save remove account-->
    <div class="flex justify-content-end gap-8 ml-4">
        <button
            type="button"
            pButton
            icon="pi pi-save"
            (click)="onSaveAllAccount()"
            [disabled]="fixedAssetsSelected.length === 0"
        ></button>
    </div>
</div>

<!--table ccdc-->
<p-table
    #dt1
    [value]="fixedAssets"
    dataKey="id"
    [rows]="10"
    [loading]="loading"
    [rowHover]="true"
    selectionMode="multiple"
    [(selection)]="fixedAssetsSelected"
    styleClass="p-datatable-gridlines sidebar-custom"
    [paginator]="true"
    [responsiveLayout]="'scroll'"
    [totalRecords]="totalRecords"
    [rowsPerPageOptions]="[50]"
    [showCurrentPageReport]="true"
    [lazy]="true"
    (onLazyLoad)="getFixedAssets($event)"
    scrollDirection="both"
    [scrollable]="true"
    currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
    [(first)]="first"
>
    <ng-template pTemplate="header">
        <tr>
            <th style="min-width: 20px; width: 3%">
                <p-checkbox
                    [(ngModel)]="checkAllFixedAsset"
                    [binary]="true"
                    inputId="binary"
                    *ngIf="fixedAssets.length"
                    (onChange)="onCheckAllFixedAsset()"
                ></p-checkbox>
            </th>
            <th style="min-width: 50px; width: 5%">
                <div class="flex align-items-center">
                    <span [translate]="'label.code'"></span>
                </div>
            </th>
            <th style="min-width: 150px; width: 17%">
                <div class="flex align-items-center">
                    <span [translate]="'label.fixed_assets_name'"></span>
                </div>
            </th>
            <th style="min-width: 30px; width: 5%">
                <div class="flex align-items-center">
                    <span [translate]="'label.stock_quantity'"></span>
                </div>
            </th>
            <th style="min-width: 30px; width: 5%">
                <div class="flex align-items-center">
                    <span [translate]="'label.original_price'"></span>
                </div>
            </th>
            <th style="min-width: 30px; width: 5%">
                <div class="flex align-items-center">
                    <span [translate]="'label.use_date'"></span>
                </div>
            </th>
            <th style="min-width: 30px; width: 5%">
                <div class="flex align-items-center">
                    <span [translate]="'label.month_of_customer'"></span>
                </div>
            </th>
            <th style="min-width: 30px; width: 5%">
                <div class="flex align-items-center">
                    <span [translate]="'label.month_remaining'"></span>
                </div>
            </th>
            <th style="min-width: 30px; width: 5%">
                <div class="flex align-items-center">
                    <span [translate]="'label.date_of_month_use'"></span>
                </div>
            </th>
            <th style="min-width: 30px; width: 5%">
                <div class="flex align-items-center">
                    <span [translate]="'label.value_of_customer_1_day'"></span>
                </div>
            </th>
            <th style="min-width: 30px; width: 5%">
                <div class="flex align-items-center">
                    <span
                        [translate]="'label.value_of_customer_current_period'"
                    ></span>
                </div>
            </th>
            <th style="min-width: 30px; width: 5%">
                <div class="flex align-items-center">
                    <span [translate]="'label.value_remaining'"></span>
                </div>
            </th>
            <th style="min-width: 30px; width: 5%">
                <div class="flex align-items-center">
                    <span [translate]="'label.debit_code_name'"></span>
                </div>
            </th>
            <th style="min-width: 30px; width: 5%">
                <div class="flex align-items-center">
                    <span [translate]="'label.detail_1'"></span>
                </div>
            </th>
            <th style="min-width: 30px; width: 5%">
                <div class="flex align-items-center">
                    <span [translate]="'label.detail_2'"></span>
                </div>
            </th>
            <th style="min-width: 30px; width: 5%">
                <div class="flex align-items-center">
                    <span [translate]="'label.credit_code_name'"></span>
                </div>
            </th>
            <th style="min-width: 30px; width: 5%">
                <div class="flex align-items-center">
                    <span [translate]="'label.detail_1'"></span>
                </div>
            </th>
            <th style="min-width: 30px; width: 5%">
                <div class="flex align-items-center">
                    <span [translate]="'label.detail_2'"></span>
                </div>
            </th>
        </tr>
    </ng-template>
    <ng-template pTemplate="body" let-fixedAsset>
        <tr>
            <td style="min-width: 20px; width: 3%">
                <p-checkbox
                    [(ngModel)]="fixedAsset.checked"
                    [binary]="true"
                    inputId="binary"
                ></p-checkbox>
            </td>
            <td style="min-width: 50px; width: 5%">
                {{
                    fixedAsset.creditDetailCodeSecond ||
                        fixedAsset.creditDetailCodeFirst
                }}
            </td>
            <td style="min-width: 150px; width: 17%">
                <span
                    class="p-column-title"
                    [translate]="'label.fixed_assets_name'"
                ></span
                >{{ fixedAsset.name }}
            </td>
            <td style="min-width: 50px; width: 5%">
                {{ fixedAsset.quantity | number }}
            </td>
            <td style="min-width: 50px; width: 5%">
                <p-inputNumber
                    class="p-inputtext-sm"
                    [(ngModel)]="fixedAsset.historicalCost"
                    [ngModelOptions]="{ standalone: true }"
                >
                </p-inputNumber>
            </td>
            <td style="min-width: 50px; width: 5%">
                {{ fixedAsset.usedDate | date: "dd-MM-YYYY" }}
            </td>
            <td style="min-width: 50px; width: 5%">
                <p-inputNumber
                    class="p-inputtext-sm"
                    [(ngModel)]="fixedAsset.totalMonth"
                    [ngModelOptions]="{ standalone: true }"
                ></p-inputNumber>
            </td>
            <td style="min-width: 50px; width: 5%">
                <p-inputNumber
                    class="p-inputtext-sm"
                    [(ngModel)]="fixedAsset.totalMonthLeft"
                    [ngModelOptions]="{ standalone: true }"
                ></p-inputNumber>
            </td>
            <td style="min-width: 50px; width: 5%">
                <p-inputNumber
                    class="p-inputtext-sm"
                    [(ngModel)]="fixedAsset.totalDayDepreciationOfThisPeriod"
                    [ngModelOptions]="{ standalone: true }"
                ></p-inputNumber>
            </td>
            <td style="min-width: 50px; width: 5%">
                <p-inputNumber
                    class="p-inputtext-sm"
                    [(ngModel)]="fixedAsset.depreciationOfOneDay"
                    [ngModelOptions]="{ standalone: true }"
                ></p-inputNumber>
            </td>
            <td style="min-width: 50px; width: 5%">
                <p-inputNumber
                    class="p-inputtext-sm"
                    [(ngModel)]="fixedAsset.depreciationOfThisPeriod"
                    [ngModelOptions]="{ standalone: true }"
                ></p-inputNumber>
            </td>
            <td style="min-width: 50px; width: 5%">
                <p-inputNumber
                    class="p-inputtext-sm"
                    [(ngModel)]="fixedAsset.carryingAmount"
                    [ngModelOptions]="{ standalone: true }"
                ></p-inputNumber>
            </td>
            <td style="min-width: 50px; width: 5%">
                {{ fixedAsset.debitCode }}
            </td>
            <td style="min-width: 50px; width: 5%">
                {{ fixedAsset.debitDetailCodeFirst }}
            </td>
            <td style="min-width: 50px; width: 5%">
                {{ fixedAsset.debitDetailCodeSecond }}
            </td>
            <td style="min-width: 50px; width: 5%">
                {{ fixedAsset.creditCode }}
            </td>
            <td style="min-width: 50px; width: 5%">
                {{ fixedAsset.creditDetailCodeFirst }}
            </td>
            <td style="min-width: 50px; width: 5%">
                {{ fixedAsset.creditDetailCodeSecond }}
            </td>
        </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage">
        <tr>
            <td class="w-full pt-4 pb-4">No {{ type }} found.</td>
        </tr>
    </ng-template>
    <ng-template pTemplate="loadingbody">
        <tr>
            <td class="w-full pt-4 pb-4">
                Loading {{ type }} data. Please wait.
            </td>
        </tr>
    </ng-template>
</p-table>

<div class="flex justify-content-end gap-8 mt-4">
    <button
        type="button"
        pButton
        icon="pi pi-times"
        [label]="'button.back' | translate"
        (click)="onCancel.emit({})"
    ></button>
    <button
        class="p-button-info"
        type="button"
        pButton
        icon="pi pi-check"
        [label]="'button.save' | translate"
        (click)="onSaveAll()"
    ></button>
</div>
